'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}(function(){'use strict';var PxSlider=function(){function PxSlider(){_classCallCheck(this,PxSlider)}_createClass(PxSlider,[{key:'beforeRegister',value:function beforeRegister(){this.is='px-slider';this.properties=this.properties||{}}},{key:'ready',value:function ready(){window.requestAnimationFrame(this._animationFrame.bind(this))}},{key:'_animationFrame',value:function _animationFrame(){var startHandle=Px.d3.select(this.$$('#handleStart'));var endHandle=Px.d3.select(this.$$('#handleEnd'));this.set('_startHandle',startHandle);this.set('_endHandle',endHandle);this._buildHandles();this._setupListeners()}},{key:'_setupListeners',value:function _setupListeners(){if(this._startHandle&&this._endHandle){if(this.disabled){this._removeHandleListeners();this._removeTrackListeners()}else{this._createHandleListeners(this._startHandle,'value');this._createHandleListeners(this._endHandle,'endValue');this._createTrackListeners()}this._toggleDisabledClass()}}},{key:'_createHandleListeners',value:function _createHandleListeners(handle,valueVar){var handleBody=handle.select('.handleBody'),handleLines=handle.selectAll('.handleLines'),handleShadow=handle.select('.handleDropShadow');handle.call(d3.drag().on('start.interrupt',function(){handle.interrupt()}).on('start drag',function(){handleBody.classed('handleBodyPressed',true);handleLines.classed('handleLinesPressed',true);handleShadow.classed('handleDropShadowPressed',true);this._calcSliderValue(d3.event.x,valueVar)}.bind(this)).on('end',function(){handleBody.classed('handleBodyPressed',false);handleLines.classed('handleLinesPressed',false);handleShadow.classed('handleDropShadowPressed',false)})).on('mouseenter',function(){handleBody.classed('handleBodyHover',true);handleLines.classed('handleBodyHover',true)}).on('mouseleave',function(){handleBody.classed('handleBodyHover',false);handleLines.classed('handleBodyHover',false)})}},{key:'_createTrackListeners',value:function _createTrackListeners(){var _this=this,interactionRects=Px.d3.selectAll(Polymer.dom(this.$$('#sliderSVG')).querySelectorAll('.sliderTrack'));interactionRects.on('click',function(){_this._trackOnClick(this)})}},{key:'_trackOnClick',value:function _trackOnClick(elem){var val=d3.mouse(elem)[0],prop='value';if(this.isRange){var scaled=this._scale.invert(val),half=(this.endValue-this.value)/2+this.value;prop=scaled>this.endValue||scaled>half?'endValue':'value'}this._calcSliderValue(val,prop)}},{key:'_removeHandleListeners',value:function _removeHandleListeners(){this._startHandle.on('.drag',null);this._endHandle.on('.drag',null)}},{key:'_removeTrackListeners',value:function _removeTrackListeners(){var interactionRects=Px.d3.selectAll(Polymer.dom(this.$$('#sliderSVG')).querySelectorAll('.sliderTrack'));interactionRects.on('click',null)}},{key:'_buildHandles',value:function _buildHandles(){if(this._handleDefinitions&&this._startHandle&&this._endHandle){if(this.isRange){this._startHandle.select('.handleDropShadow').attr('d',this._handleDefinitions.up.shadowD);this._startHandle.select('.handleBody').attr('d',this._handleDefinitions.up.bodyD);this._startHandle.selectAll('.handleLines').attr('y1',this._handleDefinitions.up.linesY1).attr('y2',this._handleDefinitions.up.linesY2);this._endHandle.select('.handleDropShadow').attr('d',this._handleDefinitions.down.shadowD);this._endHandle.select('.handleBody').attr('d',this._handleDefinitions.down.bodyD);this._endHandle.selectAll('.handleLines').attr('y1',this._handleDefinitions.down.linesY1).attr('y2',this._handleDefinitions.down.linesY2)}else{this._startHandle.select('.handleDropShadow').attr('d',this._handleDefinitions.square.shadowD);this._startHandle.select('.handleBody').attr('d',this._handleDefinitions.square.bodyD);this._startHandle.selectAll('.handleLines').attr('y1',this._handleDefinitions.square.linesY1).attr('y2',this._handleDefinitions.square.linesY2);this._endHandle.select('.handleDropShadow').attr('d',null);this._endHandle.select('.handleBody').attr('d',null);this._endHandle.selectAll('.handleLines').attr('y1',null).attr('y2',null)}}}},{key:'_assignInputElems',value:function _assignInputElems(){Polymer.dom.flush();this.set('_inputStart',this.$$('#inputStart'));this.set('_inputEnd',this.$$('#inputEnd'))}},{key:'_onIronResize',value:function _onIronResize(){this.debounce('ironresize',function(){var wrapperRect=this.$.wrapper.getBoundingClientRect(),startInputSize=this._inputStart?this._inputStart.getBoundingClientRect().width:0,startInputMargin=this._inputStart?Number(window.getComputedStyle(this._inputStart).marginRight.split('px')[0]):0,endInputSize=this._inputEnd?this._inputEnd.getBoundingClientRect().width:0,endInputMargin=this._inputEnd?Number(window.getComputedStyle(this._inputEnd).marginLeft.split('px')[0]):0,w=wrapperRect.width-startInputSize-endInputSize-startInputMargin-endInputMargin-this._margin.left-this._margin.right;this.set('_width',Math.max(w,0))},10)}},{key:'_hideInputsChanged',value:function _hideInputsChanged(){if(this.hideInputs){this.set('_showStartInput',false);this.set('_showEndInput',false)}else{this.set('_showStartInput',true);this.set('_showEndInput',this.isRange)}this._assignInputElems();this.notifyResize()}},{key:'_getSvgWith',value:function _getSvgWith(){return this._width+this._margin.left+this._margin.right}},{key:'_getSvgHeight',value:function _getSvgHeight(){return this._height+this._margin.top+this._margin.bottom}},{key:'_calcTransform',value:function _calcTransform(){return'translate('+this._margin.left+','+this._margin.top+')'}},{key:'_stepChanged',value:function _stepChanged(){if(this.step<0){console.warn('Improper configuration: step cannot be negative. Falling back to absolute value');this.set('step',Math.abs(this.step));return}if(this.step===0){console.warn('Improper configuration: step cannot be negative. Falling back to 1');this.set('step',1);return}}},{key:'_minOrMaxChanged',value:function _minOrMaxChanged(){var min,max;if(this.min===this.max){this.set('_minMaxValid',0);console.warn('Improper configuration: min and max are the same. Increasing max by step size.');this.set('max',this.min+this.step);return}if(this.min>this.max){this.set('_minMaxValid',0);console.warn('Improper configuration: min and max are reversed. Swapping them.');var temp=this.min;this.set('min',this.max);this.set('max',temp);return}this.set('_minMaxValid',(this._minMaxValid||0)+1)}},{key:'_createScale',value:function _createScale(){this.debounce('_createScale',function(){this._createScaleDebounced()},10)}},{key:'_createScaleDebounced',value:function _createScaleDebounced(){var scale;if(this.scale==='linear'){scale=Px.d3.scaleLinear().clamp(true)}else if(this.scale==='logarithmic'){scale=Px.d3.scaleLog().base(this.base).clamp(true)}else if(this.scale==='exponential'){scale=Px.d3.scalePow().exponent(this.exponent).clamp(true)}this.set('_scale',scale)}},{key:'_setRange',value:function _setRange(){this.debounce('_setRange',function(){if(this._scale&&this._width&&this._height){this._setRangeDebouced()}},10)}},{key:'_setRangeDebouced',value:function _setRangeDebouced(){if(this.orientation==='vertical'){var h=Math.max(this._height,0),range=[h,0]}else{var w=Math.max(this._width,0),range=[0,w]}this._scale.range(range);this._scaleChanged=!this._scaleChanged}},{key:'_setDomain',value:function _setDomain(){this.debounce('_setDomain',function(){if(this._scale&&this._minMaxValid){this._setDomainDebounced()}},10)}},{key:'_setDomainDebounced',value:function _setDomainDebounced(){this._scale.domain([this.min,this.max]);this._scaleChanged=!this._scaleChanged}},{key:'_calcSliderValue',value:function _calcSliderValue(mouseVal,valueVar){this.debounce('_calcSliderValue',function(){this._calcSliderValueDebounced(mouseVal,valueVar)},10)}},{key:'_calcSliderValueDebounced',value:function _calcSliderValueDebounced(mouseVal,valueVar){var val=this._scale.invert(mouseVal),stepped=this._calcStepRounded(val),inputElem=valueVar==='value'?this._inputStart:this._inputEnd;if(this.isRange){stepped=valueVar==='value'&&stepped>this.endValue?this.endValue:stepped;stepped=valueVar==='endValue'&&stepped<this.value?this.value:stepped}this.toggleClass('validation-error',false,inputElem);this.set(valueVar,stepped)}},{key:'_calcStepRounded',value:function _calcStepRounded(value){var s=Math.round(value/this.step)*this.step;s=s<this.min?s+this.step:s;s=s>this.max?s-this.step:s;return s}},{key:'_valueChanged',value:function _valueChanged(v){if(this._startHandle){this._moveHandle(this._startHandle,v)}}},{key:'_endValueChanged',value:function _endValueChanged(v){if(v&&this._endHandle){this._moveHandle(this._endHandle,v)}}},{key:'_moveHandle',value:function _moveHandle(handle,v){handle.attr('transform','translate('+this._scale(v)+',0)')}},{key:'_calcProgressStart',value:function _calcProgressStart(){if(this.isRange){return this._scale(this.value)}return 0}},{key:'_calcProgressEnd',value:function _calcProgressEnd(){if(this.isRange){return Math.max(this._scale(this.endValue)-this._scale(this.value),1)}return this._scale(this.value)}},{key:'_updateFormat',value:function _updateFormat(){if(this.format){this.set('_format',this.format);return}var s=this.step.toString().split('.'),l=s.length===2?s[1].length:0,f='0.';for(var i=0;i<l;i++){f+='0'}this.set('_format',f)}},{key:'_inputChangedStart',value:function _inputChangedStart(evt){var text=this._inputStart.value;this._inputChanged(text,this._inputStart,'#formatterStart','value')}},{key:'_inputChangedEnd',value:function _inputChangedEnd(evt){var text=this._inputEnd.value;this._inputChanged(text,this._inputEnd,'#formatterEnd','endValue')}},{key:'_inputChanged',value:function _inputChanged(text,inputElem,formatterId,valueVar){var formatter=this.$$(formatterId),newVal;formatter.set('unformat',text);newVal=formatter.unformattedValue;if(!newVal&&newVal!==0){this.toggleClass('validation-error',true,inputElem);return}newVal=Math.max(newVal,this.min);newVal=Math.min(newVal,this.max);newVal=this._calcStepRounded(newVal);if(this.isRange){if(valueVar==='value'&&newVal>this.endValue||valueVar==='endValue'&&newVal<this.value){this.toggleClass('validation-error',true,inputElem);return}}this.toggleClass('validation-error',false,inputElem);this[valueVar]=null;this.set(valueVar,newVal)}},{key:'_restoreStartInputValue',value:function _restoreStartInputValue(evt){this._restoreInputValue(this._inputStart,this.formattedStartValue)}},{key:'_restoreEndInputValue',value:function _restoreEndInputValue(evt){this._restoreInputValue(this._inputEnd,this.formattedEndValue)}},{key:'_restoreInputValue',value:function _restoreInputValue(input,formattedVal){input.blur();input.value=formattedVal;this.toggleClass('validation-error',false,input)}},{key:'_checkEndValue',value:function _checkEndValue(){var v=this._calcStepRounded(this.endValue);if(v>=this.value&&v<=this.max){this.set('endValue',v)}else{var m=this._calcStepRounded(this.max);this.set('endValue',m)}}},{key:'_isRangeChanged',value:function _isRangeChanged(){this._checkEndValue();this._hideInputsChanged();this._buildHandles()}},{key:'_toggleDisabledClass',value:function _toggleDisabledClass(){this._startHandle.classed('disabled',this.disabled);this._endHandle.classed('disabled',this.disabled)}},{key:'_returnLabel',value:function _returnLabel(label,showLabels){return showLabels?label:''}},{key:'_returnLabelPosition',value:function _returnLabelPosition(labelPosition){return labelPosition==='top'?-15:18}},{key:'_returnLabelBaseline',value:function _returnLabelBaseline(labelPosition){return labelPosition==='top'?'baseline':'hanging'}},{key:'behaviors',get:function get(){return this._behaviors||(this._behaviors=[Polymer.IronResizableBehavior,PxNumberFormatter.commonProperties])},set:function set(value){this._behaviors=value}},{key:'properties',set:function set(value){this._properties=value},get:function get(){return{_height:{type:Number,value:52},_width:{type:Number,value:52},_margin:{type:Object,notify:true,value:function value(){return{left:13,right:13,top:21,bottom:21}}},value:{type:Number,notify:true,value:0},endValue:{type:Number,notify:true,value:null},formattedStartValue:{type:String},formattedEndValue:{type:String},min:{type:Number,value:1},max:{type:Number,value:100},_minMaxValid:{type:Number,value:0},step:{type:Number,value:1,observer:'_stepChanged'},disabled:{type:Boolean,value:false,observer:'_setupListeners'},hideInputs:{type:Boolean,value:false},_showStartInput:{type:Boolean,value:true},_showEndInput:{type:Boolean,value:false},isRange:{type:Boolean,value:false},scale:{type:String,value:'linear',observer:'_createScale'},base:{type:Number,value:10},exponent:{type:Number,value:1},_scale:{type:Function},_scaleChanged:{type:Boolean},_startHandle:{type:Object},_endHandle:{type:Object},_inputStart:{type:HTMLElement},_inputEnd:{type:HTMLElement},_format:{type:String,value:'0'},showLabels:{type:Boolean,value:false},minLabelPosition:{type:String,value:'bottom'},maxLabelPosition:{type:String,value:'bottom'},_handleDefinitions:{type:Object,value:function value(){return{'square':{'shadowD':'M-11,-1a3,3,0,0,1,3-3h16a3,3,0,0,1,3,3v15a3,3,0,0,1,-3,3h-16a3,3,0,0,1,-3-3Z','bodyD':'M-11,-2a3,3,0,0,1,3-3h16a3,3,0,0,1,3,3v15a3,3,0,0,1,-3,3h-16a3,3,0,0,1,-3-3Z','linesY1':'2','linesY2':'9'},'down':{'shadowD':'M-10.5,-16a3,3,0,0,1,3-3h16a3,3,0,0,1,3,3v9l-10.5,8h-1l-10.5,-8Z','bodyD':'M-10.5,-17a3,3,0,0,1,3-3h16a3,3,0,0,1,3,3v9l-10.5,8h-1l-10.5,-8Z','linesY1':'-15','linesY2':'-8'},'up':{'shadowD':'M11,18.5v9c0,1.7-1.3,3-3,3h-16c-1.7,0-3-1.3-3-3v-9l10.5,-8h1l10.5,8Z','bodyD':'M11,17.5v9c0,1.7-1.3,3-3,3h-16c-1.7,0-3-1.3-3-3v-9l10.5,-8h1l10.5,8Z','linesY1':'18','linesY2':'25'}}}}}}},{key:'listeners',get:function get(){return{'iron-resize':'_onIronResize'}}},{key:'observers',get:function get(){return['_minOrMaxChanged(min, max)','_setRange(_scale, _width, _height)','_setDomain(_scale, _minMaxValid)','_valueChanged(value, _scale, _scaleChanged)','_endValueChanged(endValue, _scale, _scaleChanged)','_updateFormat(step)','_updateFormat(format)','_isRangeChanged(isRange)','_hideInputsChanged(hideInputs)']}}]);return PxSlider}();Polymer(PxSlider)})();
//# sourceMappingURL=px-slider.js.map
